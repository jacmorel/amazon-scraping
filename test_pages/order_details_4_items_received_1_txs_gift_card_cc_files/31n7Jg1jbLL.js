(function(f){var a=window.AmazonUIPageJS||window.P,u=a._namespace||a.attributeErrors,b=u?u("InTransitActionsBuzzAssets",""):a;b.guardFatal?b.guardFatal(f)(b,window):b.execute(function(){f(b,window)})})(function(f,a,u){"use strict";f.register("in-transit-csm-metrics-utils",function(){var b;try{var d=navigator.userAgent}catch(c){d=""}d&&(d=d.toLowerCase(),(d=d.match(/(chrome|firefox|safari|trident|ddge|opr|crios|fxios)/gi))&&0<d.length&&(-1<d.indexOf("safari")&&1<d.length?-1<d.indexOf("chrome")||-1<
d.indexOf("crios")?b="chrome":-1<d.indexOf("fxios")&&(b="firefox"):b=d[0]));var e=[],g=function(c){a.ue&&a.uex&&uex("ld",c,{wb:1});c=e.indexOf(c);-1<c&&e.splice(c,1)};a.addEventListener("beforeunload",function(c){for(;0<e.length;)g(e[0])});return{setScope:function(c){a.ue&&a.uet&&a.uet("tc",c);return c},setPreAjax:function(c){a.ue&&a.ues&&a.ues("t0",c,new Date)},setPostAjax:function(c){a.ue&&a.uet&&a.uet("be",c)},sendAjaxMetrics:function(c){a.ue&&a.uex&&a.uex("ld",c)},recordReftag:function(c,a){c.ajax({type:"POST",
url:"/gp/mobile/tag?"+a,success:function(a){console.log("record ref tag ajax call success: ",a)},error:function(a){console.log("ref tag ajax call error: ",a)}})},logFatal:function(c){if(a.ueLogError){var b=c.feature||"pt2-fatal-generic";a.ueLogError(c.error||{message:c.message||b},{logLevel:"FATAL",attribution:b})}},logError:function(c){if(a.ueLogError){var b=c.feature||"pt2-error-generic";a.ueLogError(c.error||{message:c.message||b},{logLevel:"ERROR",attribution:b})}},logWarn:function(c){if(a.ueLogError){var b=
c.feature||"pt2-warn-generic";a.ueLogError(c.error||{message:c.message||b},{logLevel:"WARN",attribution:b})}},incrementCount:function(c,g){a.ue&&a.ue.count&&(a.ue.count(c,(a.ue.count(c)||0)+1),g&&g.browser&&b&&a.ue.count(c+"-"+b,(a.ue.count(c+"-"+b)||0)+1))},startWidgetTimer:function(c){a.ue&&a.uet&&0>e.indexOf(c)&&(uet("bb",c,{wb:1}),e.push(c))},stopWidgetTimer:g}});"use strict";f.when("A").register("in-transit-url-utils",function(a){function b(a){return a.split("\x26").reduce(function(a,b){b=b.split("\x3d").map(function(a){return decodeURIComponent(a.replace(/\+/g,
" "))});a[b[0]]=b[1];return a},{})}var e=a.$;return{getQueryParameterFromUrl:function(a,c){a=-1<a.indexOf("?")?a.substr(a.indexOf("?")):"";-1<a.indexOf("#")&&(a=a.substring(0,a.indexOf("#")));a=b(a);return a[c]?a[c]:!1},addQueryParameterToUrl:function(a,b){var c=!1;-1<a.indexOf("#")&&(c=a.substring(a.indexOf("#")),a=a.substr(0,a.indexOf("#")));b=e.param(b);a=-1<a.indexOf("?")?a+("\x26"+b):a+("?"+b);return c?a+c:a}}});"use strict";f.when("A","in-transit-csm-metrics-utils","ready").register("in-transit-sign-in-again-or-do",
function(b,d){var e=-1!==a.location.host.indexOf("hp-shoppingportal")?"/portal/cstrac/progress-tracker/actions/is-authenticated":"/progress-tracker/package/actions/is-authenticated",g;return function(c,d,f,l,q){b.post(e,{params:{csrfToken:l.csrfToken},success:function(b){b.success&&b.value?q&&q():b.success?(b=c.$currentTarget,l.width=620>a.innerWidth?.75*a.innerWidth:600,l.name=f,l.dataStrategy="preload",g||(g=d.create(b,l)),g.update({header:l.header||""}).show()):console.log("service failed")},error:function(a){}})}});
"use strict";f.when("A","in-transit-csm-metrics-utils","a-tooltip","ready").register("in-transit-tooltip",function(a,d,e){function b(a){d.incrementCount(a+"-total");l&&(d.incrementCount(a+"-unique"),l=!1)}function c(a){m("body").addClass("in-transit-tooltip-style-override "+f.deviceType);m(".in-transit-tooltip-trigger."+a).attr("title","")}var m=a.$,f=a.state("page-state")||{},l=!0,q=function(d){a.declarative("a-tooltip","mouseenter",function(a){c(d);b(d)});a.declarative("a-tooltip","click",function(a){a.$event.preventDefault()})},
n=function(d){a.declarative("a-tooltip","click",function(a){c(d);a=m(".in-transit-tooltip-trigger."+d);a=e.get(a);a.isVisible()?a.hide():b(d)})};return function(a){"desktop"!==f.deviceType&&f.deviceType?n(a):q(a)}});"use strict";f.when("A","a-modal","a-button","jQuery","in-transit-url-utils","in-transit-csm-metrics-utils","in-transit-tooltip","ready").register("rescheduleDelivery",function(b,d,e,f,c,m,u){function g(){b.state.parse();p=b.state("page-state")||{};w=x();v=t+w;B=1==p.stringDebug;y=h("#reschedule-calendar-page-container").hasClass("r2w");
h(".in-transit-tooltip-trigger.reschedule-tooltip-trigger").length&&u("reschedule-tooltip-trigger");q();r()}function q(){var b=h(".reschedule-day.enabled"),c=h(".delivery-window"),d=h(".day-choice-button",".reschedule-day.enabled"),e=h(".window-choice-button",".delivery-window.enabled"),v=h(".reschedule-go-back"),f=h(".reschedule-month-label"),g=h(".calendar-inner-month-name");d.click(function(a){a=h(this).parent();if(!a.hasClass("selected")){b.removeClass("selected").attr("aria-checked","false");
a.addClass("selected").attr("aria-checked","true");var d=a.data("day-number");d=h("#delivery-window-for_"+d);var k=a.data("month-title");f.text()!==k&&f.text(k);g.show().filter(function(a){return this.getAttribute("data-for-month-title")===k}).hide();c.removeClass("selected").attr("aria-checked","false");y?d.addClass("visible").siblings().removeClass("visible"):d.find(".delivery-window").addClass("selected").attr("aria-checked","true");r()}});e.click(function(a){a=h(this).parent();a.hasClass("selected")||
(c.removeClass("selected").attr("aria-checked","false"),a.addClass("selected").attr("aria-checked","true"),r())});v.click(function(){a.history&&"function"===typeof a.history.back&&a.history.back()})}function n(){var a=h(".delivery-window.selected"),b={day:null,window:null,tokenId:null};if(1!==h(".reschedule-day.selected").length||1!==a.length)return b;b.day=a.first().text();b.window=a.first().text();b.tokenId=a.first().data("token");return b}function r(){var a=e("#reschedule-submit-button"),b=n();
b.tokenId&&null!==b.tokenId?a.enable():a.disable()}function x(){return"?"+h.param({orderId:p.orderId,shipmentId:p.shipmentId,packageIndex:p.packageIndex})+"\x26amzlMessageId\x3d"}var h=b.$,p=b.state("page-state")||{},t=-1!==a.location.host.indexOf("hp-shoppingportal")?"/portal/cstrac/progress-tracker":"/progress-tracker/package",z=t+"/actions/in-transit/reschedule",A={isModalContent:"1"},w=x(),v=t+w,B=1==p.stringDebug,y=h("#reschedule-calendar-page-container").hasClass("r2w");b.declarative("intransit-reschedule-open-modal",
"click",function(k){k.$event.preventDefault();var e=k.$currentTarget;e.find("a").data("ref");k=b.extend({},k.data);k.width=620>a.innerWidth?.75*a.innerWidth:600;k.name="rescheduleCalendarModal";k.dataStrategy="ajax";"#"===e.find("a").attr("href")?k.url=e.find("a").attr("data-modalurl"):k.url=e.find("a").attr("href");k.url=c.addQueryParameterToUrl(k.url,A);d.create(e,k).show()});r();g();b.on("a:popover:ajaxContentLoaded:rescheduleCalendarModal",g);b.declarative("submit-reschedule","click",function(c){c.$event.preventDefault();
c=e("#reschedule-submit-button");if(!1!==c.isEnabled()){c.disable();var d=n().tokenId;c=y?"R2W":"R2D";"undefined"===typeof d||null===d||"undefined"===d?(d=y?"request-reschedule-ajax-call-window-toggle-token-not-set":"request-reschedule-ajax-call-token-never-attempted-to-set",m.logError({feature:d,message:"The reschedule token was not set before submitting ("+c+")"}),m.incrementCount(d),a.location=v+"8"):b.post(z,{params:{rescheduleToken:d,stringDebug:B,csrfToken:a.csrfToken},dataType:"json",success:function(b){var c=
b.requestRescheduleDisplayResponse;if(b.success)m.incrementCount("request-reschedule-ajax-call-success"),a.location=v+"7";else{m.incrementCount("request-reschedule-ajax-call-failure");c=(c=c.failureReason)||0;var d="";c&&(d=", failureReason: "+c);m.logError({feature:"request-reschedule-ajax-call-failure-log",message:"Failed to request reschedule due to responseCode: "+b.responseCode+d});a.location=v+"8"}},error:function(b){m.incrementCount("request-reschedule-ajax-call-error");m.logError({feature:"request-reschedule-ajax-call-error-log",
message:("Error making a request to reschedule with",b)});a.location=v+"8"}})}})});"use strict";f.when("A","in-transit-url-utils","rescheduleDelivery","inTransitPackageCancellation","ready").execute("in-transit-loaded",function(b,d){var e=["PackageProgressTracker"];"desktop"===(b.state("page-state")||{}).deviceType&&(d=d.getQueryParameterFromUrl(a.location.search||a.location.href,"showModal"))&&-1<e.indexOf(a.uept.pageType||"")&&(e=d.replace(/[^0-9a-z\-_]/gi,""),b=b.$("[data-action\x3d"+e+"]"),1===
b.length&&b.click())});"use strict";f.when("A","mash","page-load").execute(function(b,d){var e=document.getElementById("redirectToPickupPointCTA");e&&(e.onclick=function(){try{return d.navstack.begin().modalOpen(e.href).end(),!1}catch(g){console.log(g)}},a.addEventListener("popstate",function(){if(!a.location.href.includes("location-selector"))try{d.navstack.begin().modalClose().end()}catch(g){console.log(g)}}))});"use strict";f.when("A","a-modal","a-button","in-transit-url-utils","in-transit-csm-metrics-utils",
"ready").register("inTransitPackageCancellation",function(b,d,e,f,c){function g(){b.state.parse();n=b.state("page-state")||{};p=l();t=r+p;z=1==n.stringDebug;u()}function u(){q(".cancel-go-back").click(function(){a.history&&"function"===typeof a.history.back&&a.history.back()})}function l(){return"?"+q.param({orderId:n.orderId,shipmentId:n.shipmentId,packageIndex:n.packageIndex})+"\x26amzlMessageId\x3d"}var q=b.$,n=b.state("page-state")||{},r=-1!==a.location.host.indexOf("hp-shoppingportal")?"/portal/cstrac/progress-tracker":
"/progress-tracker/package",x=r+"/actions/in-transit/cancel",h={isModalContent:"1"},p=l(),t=r+p,z=1==n.stringDebug,A,w;b.declarative("intransit-cancel-open-modal","click",function(c){c.$event.preventDefault();var e=c.$currentTarget;e.find("a").data("ref");c=b.extend({},c.data);c.width=620>a.innerWidth?.75*a.innerWidth:600;c.name="cancelModal";c.dataStrategy="ajax";"#"===e.find("a").attr("href")?c.url=e.find("a").attr("data-modalurl"):c.url=e.find("a").attr("href");c.url=f.addQueryParameterToUrl(c.url,
h);d.create(e,c).show()});g();b.on("a:popover:ajaxContentLoaded:cancelModal",g);b.declarative("submit-intransit-cancel","click",function(d){d.$event.preventDefault();var e=document.getElementById("cancel-modal-data").dataset;d=e.deviceType;var f=e.isApp;e={orderId:e.orderId,shipmentId:e.shipmentId,packageId:e.packageIndex,stringDebug:z,deviceType:d,isApp:f,csrfToken:a.csrfToken};A="desktop"===d?"dt_":"mob_";w=f?"ap_":"b_";var g="\x26ref\x3dppx_pt2_"+A+w+"cancel_deli_submit";b.post(x,{params:e,dataType:"json",
success:function(b){var d=b.requestPackageCancellationDisplayResponse;if(b.success)c.incrementCount("request-intransit-cancel-ajax-call-success"),a.location=t+"15"+g;else{c.incrementCount("request-intransit-cancel-ajax-call-failure");d=(d=d.displayableCancelMessage)||0;var e="";d&&(e=", failureReason: "+d);c.logError({feature:"request-intransit-cancel-ajax-call-failure-log",message:"Failed to request package cancellation due to responseCode: "+b.responseCode+e});a.location=t+"6"+g}},error:function(b){c.incrementCount("request-intransit-cancel-ajax-call-error");
c.logError({feature:"request-intransit-cancel-ajax-call-failure-log",message:("Error making a request to package cancellation with",b)});a.location=t+"6"+g}})})})});